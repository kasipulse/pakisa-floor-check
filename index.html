<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Floor Check – Read Only</title>

<style>
  body { font-family: Arial; padding:20px; background:#f5f7fa; }
  .card { background:white; padding:20px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.08); }
  input, select { width:100%; padding:12px; margin:10px 0; border-radius:8px; border:1px solid #ccc; }
  .list-item { background:#fff; padding:12px; margin:6px 0; border-radius:8px; border:1px solid #eee; }
  .btn-login { background:#072760; color:white; padding:12px; width:100%; border-radius:8px; border:0; margin-top:20px; }
</style>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getDatabase, ref, onValue, query, orderByChild, equalTo } 
    from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBh-KhkmZrS6b97MPv-YTMjU6qTF0qFzbY",
    authDomain: "pakisa-floor.firebaseapp.com",
    databaseURL: "https://pakisa-floor-default-rtdb.firebaseio.com/"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let currentData = [];

  function load(date) {
    const q = query(ref(db, "scans"), orderByChild("date"), equalTo(date));
    const list = document.getElementById("scanList");

    onValue(q, snap => {
      currentData = [];
      list.innerHTML = "";

      snap.forEach(s => currentData.push(s.val()));
      render(currentData);
    });
  }

  function render(arr) {
    const list = document.getElementById("scanList");
    list.innerHTML = "";

    arr.forEach(d => {
      const div = document.createElement("div");
      div.className = "list-item";
      div.innerHTML = `<b>${d.waybill}</b><br>${d.customer} — ${d.reason}`;
      list.appendChild(div);
    });
  }

  window.filterSearch = () => {
    const term = document.getElementById("searchInput").value.toLowerCase();
    render(currentData.filter(d =>
      d.waybill.toLowerCase().includes(term) ||
      d.customer.toLowerCase().includes(term) ||
      d.reason.toLowerCase().includes(term)
    ));
  };

  window.changeDate = () => {
    load(document.getElementById("dateFilter").value);
  };

  window.onload = () => {
    const today = new Date().toISOString().split("T")[0];
    document.getElementById("dateFilter").value = today;
    load(today);
  };
</script>
</head>

<body>
<center>
  <img src="https://res.cloudinary.com/dwxgkbuln/image/upload/v1750675472/pakisa_logistics_express_pty_ltd_logo-removebg-preview_kbuvzs.png" width="180">
</center>

<div class="card">
  <h2>Floor Check (Read Only)</h2>

  <label>Date</label>
  <input type="date" id="dateFilter" onchange="changeDate()">

  <label>Search</label>
  <input id="searchInput" placeholder="Search waybill / customer / reason" onkeyup="filterSearch()">

  <h3>Scans</h3>
  <div id="scanList"><i>Loading…</i></div>

  <button class="btn-login" onclick="location.href='login.html'">
    Pakisa Agent Login
  </button>
</div>

</body>
</html>
