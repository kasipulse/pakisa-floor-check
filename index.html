<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pakisa Floor Check</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background:#f5f7fa;
    margin:0;
    padding:20px;
    color:#111827;
  }

  .container {
    max-width:900px;
    margin:auto;
  }

  .card {
    background:#fff;
    padding:16px;
    border-radius:12px;
    box-shadow:0 6px 20px rgba(0,0,0,.08);
  }

  h1 {
    margin:0 0 12px;
    color:#072760;
  }

  input {
    width:100%;
    padding:12px;
    margin:8px 0;
    border-radius:8px;
    border:1px solid #ddd;
    font-size:16px;
  }

  .item {
    background:#f9fafb;
    padding:12px;
    border-radius:8px;
    margin-bottom:8px;
    border:1px solid #e5e7eb;
  }

  footer {
    text-align:center;
    margin-top:16px;
    color:#6b7280;
    font-size:13px;
  }
</style>

<!-- ðŸ”¥ FIREBASE -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

  /* ðŸ”¥ CONFIG */
  const firebaseConfig = {
    apiKey: "AIzaSyBh-KhkmZrS6b97MPv-YTMjU6qTF0qFzbY",
    authDomain: "pakisa-floor.firebaseapp.com",
    databaseURL: "https://pakisa-floor-default-rtdb.firebaseio.com/",
    projectId: "pakisa-floor"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let allScans = [];

  function todayKey() {
    const d = new Date();
    return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
  }

  const list = document.getElementById("list");
  const searchInput = document.getElementById("search");
  const dateInput = document.getElementById("date");

  dateInput.value = todayKey();

  /* ðŸ”¥ LOAD ALL SCANS */
  onValue(ref(db, "scans"), snapshot => {
    allScans = [];

    snapshot.forEach(child => {
      allScans.push(child.val());
    });

    allScans.sort((a,b) => b.timestamp - a.timestamp);
    render();
  });

  function render() {
    const term = searchInput.value.toLowerCase();
    const date = dateInput.value;

    list.innerHTML = "";

    const filtered = allScans.filter(s =>
      (!date || s.date === date) &&
      (
        s.waybill.toLowerCase().includes(term) ||
        s.customer.toLowerCase().includes(term) ||
        s.reason.toLowerCase().includes(term)
      )
    );

    if (!filtered.length) {
      list.innerHTML = "<i>No scans found</i>";
      return;
    }

    filtered.forEach(s => {
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <b>${s.waybill}</b><br>
        ${s.customer}<br>
        <small>${s.reason}</small>
      `;
      list.appendChild(div);
    });
  }

  window.doSearch = render;
</script>
</head>

<body>
<div class="container">
  <div class="card">
    <h1>Pakisa Floor Check</h1>

    <label>Date</label>
    <input type="date" id="date" onchange="doSearch()">

    <label>Search</label>
    <input id="search" placeholder="Waybill, customer or reason" onkeyup="doSearch()">

    <div id="list"><i>Loading scansâ€¦</i></div>
  </div>

  <footer>
    Built by Mpho Mahlaba
  </footer>
</div>
</body>
</html>
