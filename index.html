<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pakisa Floor Check</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- jsPDF + autotable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col items-center p-6">

  <!-- HEADER -->
  <div class="bg-[#0a2b52] text-white w-full py-4 px-6 rounded-2xl shadow-md mb-6 flex justify-between items-center">
    <h1 class="text-xl font-bold">Pakisa Express Logistics - Floor Check</h1>
    <span class="text-sm">www.pakisalogistics.co.za</span>
  </div>

  <!-- FORM SECTION -->
  <div class="bg-white rounded-2xl shadow-md p-6 w-full max-w-4xl">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">

      <!-- Customer -->
      <div>
        <label class="font-semibold text-gray-700">Select Customer:</label>
        <select id="customerSelect" class="w-full p-2 border rounded">
          <option value="">Select customer</option>
          <option>FedEx Express</option>
          <option>Seabourne Logistics</option>
          <option>Brima Logistics</option>
          <option>AJM Couriers</option>
          <option>ACT</option>
          <option>First Freight Couriers</option>
        </select>
      </div>

      <!-- Reason -->
      <div>
        <label class="font-semibold text-gray-700">Select Reason:</label>
        <select id="reasonSelect" class="w-full p-2 border rounded">
          <option value="">Select reason</option>
          <option>Planned for next day</option>
          <option>Incorrect address</option>
          <option>No invoice on package</option>
          <option>Damaged in transit</option>
          <option>Rejected by customer</option>
          <option>Misroute</option>
          <option>No contact person</option>
          <option>Nobody home</option>
          <option>Missed booking</option>
        </select>
      </div>

      <!-- Waybill Scan -->
      <div>
        <label class="font-semibold text-gray-700">Scan or Type Waybill Number:</label>
        <input id="waybillInput" type="text" class="w-full p-2 border rounded" placeholder="Scan or type → press Enter" />
      </div>
    </div>

    <div class="flex justify-between">
      <button onclick="exportToCSV()" class="bg-[#409dbc] text-white px-4 py-2 rounded">Export CSV</button>
      <button onclick="exportToPDF()" class="bg-[#cebd80] text-black px-4 py-2 rounded">Export PDF</button>
    </div>
  </div>

  <!-- TABLE SECTION -->
  <div class="bg-white mt-6 rounded-2xl shadow-md p-6 w-full max-w-5xl overflow-x-auto">
    <table id="floorCheckTable" class="w-full border border-gray-300 text-sm text-left">
      <thead class="bg-gray-200 text-black">
        <tr>
          <th class="p-2 border">Date & Time</th>
          <th class="p-2 border">Customer</th>
          <th class="p-2 border">Reason</th>
          <th class="p-2 border">Waybill Number</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

  <!-- FOOTER -->
  <footer class="mt-8 text-gray-600 text-sm">
    Designed by <strong>Mpho Mahlaba</strong> — 
    <a href="https://pakisa-floor-check.onrender.com" class="text-blue-600 underline">https://pakisa-floor-check.onrender.com</a>
  </footer>

  <script>
    const reasonSelect = document.getElementById("reasonSelect");
    const waybillInput = document.getElementById("waybillInput");
    const tableBody = document.getElementById("tableBody");
    const customerSelect = document.getElementById("customerSelect");

    // Prevent focus loss when using dropdowns
    function keepFocus() {
      const active = document.activeElement;
      if (active.tagName !== "SELECT" && active.tagName !== "BUTTON") {
        waybillInput.focus();
      }
    }
    setInterval(keepFocus, 800);

    // Handle Enter scan
    waybillInput.addEventListener("keypress", function (e) {
      if (e.key === "Enter") {
        const waybill = waybillInput.value.trim();
        const reason = reasonSelect.value;
        const customer = customerSelect.value;
        if (waybill && reason && customer) {
          const now = new Date().toLocaleString();
          const row = `<tr>
            <td class='p-2 border'>${now}</td>
            <td class='p-2 border'>${customer}</td>
            <td class='p-2 border'>${reason}</td>
            <td class='p-2 border'>${waybill}</td>
          </tr>`;
          tableBody.insertAdjacentHTML("afterbegin", row);
          waybillInput.value = "";
          reasonSelect.selectedIndex = 0;
          customerSelect.selectedIndex = 0;
        } else {
          alert("Please select a customer and reason before scanning.");
        }
      }
    });

    // Export to CSV
    function exportToCSV() {
      const rows = [["Date & Time", "Customer", "Reason", "Waybill Number"]];
      document.querySelectorAll("#floorCheckTable tbody tr").forEach(tr => {
        const cells = Array.from(tr.querySelectorAll("td")).map(td => td.innerText);
        rows.push(cells);
      });
      let csvContent = rows.map(e => e.join(",")).join("\n");
      const blob = new Blob([csvContent], { type: "text/csv" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "floor_check_report.csv";
      a.click();
    }

    // Export to PDF
    async function exportToPDF() {
      const { jsPDF } = window.jspdf;

      const doc = new jsPDF({
        orientation: "landscape",
        unit: "mm",
        format: "a4"
      });

      const pageWidth = doc.internal.pageSize.getWidth();
      const margin = 10;

      // --- HEADER RIBBON (WHITE) ---
      doc.setFillColor(255, 255, 255);
      doc.rect(0, 0, pageWidth, 25, "F");

      // --- LOGOS ---
      const pakisaLogo = "/pakisa_logistics_express_pty_ltd_logo-removebg-preview.png";
      const freightLogo = "/first_freight_couriers_logo.png";
      doc.addImage(pakisaLogo, "PNG", margin, 3, 30, 20);
      doc.addImage(freightLogo, "PNG", 45, 3, 30, 20);

      // --- TITLE ---
      doc.setFontSize(14);
      doc.setTextColor(0, 0, 0);
      doc.text("Pakisa Express Logistics — Floor Check Report", 85, 15);

      // --- TABLE CONTENT ---
      const headers = ["Date & Time", "Customer", "Reason", "Waybill Number"];
      const rows = Array.from(document.querySelectorAll("#tableBody tr")).map(tr =>
        Array.from(tr.querySelectorAll("td")).map(td => td.innerText)
      );

      doc.autoTable({
        startY: 30,
        head: [headers],
        body: rows,
        theme: "grid",
        styles: { fontSize: 9, textColor: [0, 0, 0] },
        headStyles: { fillColor: [240, 240, 240], textColor: [0, 0, 0], fontStyle: "bold" },
        alternateRowStyles: { fillColor: [250, 250, 250] },
        margin: { left: margin, right: margin },
        tableWidth: "auto"
      });

      // --- FOOTER ---
      const footerY = doc.internal.pageSize.getHeight() - 10;
      doc.setFontSize(9);
      doc.setTextColor(100);
      doc.text("Designed by Mpho Mahlaba — https://pakisa-floor-check.onrender.com", margin, footerY);

      doc.save("floor_check_report.pdf");
    }
  </script>
</body>
</html>
