<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Floor Scan</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  tr.success { background-color: #d1fae5; } /* green */
  tr.error { background-color: #fee2e2; }   /* red */
</style>
</head>
<body class="bg-gray-100 p-6">
  <h1 class="text-3xl font-bold mb-4">Floor Scan</h1>
  <input type="text" id="scanner-input" autofocus class="border p-2 w-full mb-4" placeholder="Scan here..." />
  <table class="min-w-full bg-white rounded shadow overflow-hidden">
    <thead class="bg-gray-200">
      <tr>
        <th class="py-2 px-4">Scan</th>
        <th class="py-2 px-4">Employee</th>
        <th class="py-2 px-4">Location</th>
        <th class="py-2 px-4">Scan Date</th>
        <th class="py-2 px-4">Status</th>
      </tr>
    </thead>
    <tbody id="scan-body"></tbody>
  </table>

  <!-- Success / Error beep -->
  <audio id="success-sound" src="https://www.soundjay.com/button/beep-07.wav"></audio>
  <audio id="error-sound" src="https://www.soundjay.com/button/beep-10.wav"></audio>

<script>
const supabaseUrl = 'https://orhqnjxigboyvnwaopxu.supabase.co';
const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9yaHFuanhpZ2JveXZud2FvcHh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA0OTI3MTksImV4cCI6MjA3NjA2ODcxOX0.KAk9QL0T7VwzXdbH1-Rei0P9x0XHeEI4jcDuPHxK28M';
const supabase = Supabase.createClient(supabaseUrl, supabaseAnonKey);

const input = document.getElementById('scanner-input');
const tbody = document.getElementById('scan-body');
const successSound = document.getElementById('success-sound');
const errorSound = document.getElementById('error-sound');

// Keep track of scanner input
let scanBuffer = '';

input.addEventListener('keydown', async (e) => {
  if (e.key === 'Enter') {
    const scanCode = scanBuffer.trim();
    scanBuffer = '';
    input.value = '';

    if (!scanCode) return;

    // Attempt to save scan
    const { data, error } = await supabase
      .from('floor_checks') // replace with your table
      .insert([{ scan_code: scanCode, scan_date: new Date().toISOString(), status: 'scanned' }])
      .select();

    const tr = document.createElement('tr');
    if (error || !data) {
      tr.classList.add('error');
      tr.innerHTML = `<td colspan="5">${scanCode} - Error: ${error ? error.message : 'Unknown'}</td>`;
      errorSound.play();
    } else {
      tr.classList.add('success');
      tr.innerHTML = `
        <td>${scanCode}</td>
        <td>${data[0].employee_name || '-'}</td>
        <td>${data[0].location || '-'}</td>
        <td>${new Date(data[0].scan_date).toLocaleString()}</td>
        <td>${data[0].status}</td>
      `;
      successSound.play();
    }
    tbody.prepend(tr);
  } else {
    // Accumulate characters from scanner
    scanBuffer += e.key;
  }
});

// Keep focus on input
input.addEventListener('blur', () => input.focus());
</script>
</body>
</html>
