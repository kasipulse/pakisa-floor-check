<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Pakisa Floor Scans</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  body { font-family: Arial, sans-serif; background:#f4f4f4; padding:20px; }
  label { font-weight:bold; display:block; margin-top:10px; }
  input { width:100%; padding:8px; margin-top:4px; }
  table { width:100%; border-collapse:collapse; margin-top:20px; }
  th, td { border:1px solid #ccc; padding:8px; }
  th { background:#0a2b52; color:#fff; }
</style>
</head>

<body>

<h2>Floor Scan Viewer</h2>

<label for="searchInput">Search</label>
<input id="searchInput" type="text" placeholder="Search waybill, customer, reason">

<table>
  <thead>
    <tr>
      <th>Waybill</th>
      <th>Customer</th>
      <th>Reason</th>
      <th>Date</th>
    </tr>
  </thead>
  <tbody id="scanBody">
    <tr><td colspan="4">Loadingâ€¦</td></tr>
  </tbody>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

/* âœ… YOUR EXACT PROJECT */
const firebaseConfig = {
  apiKey: "AIzaSyBh-KhkmZrS6b97MPv-YTMjU6qTF0qFzbY",
  authDomain: "pakisa-floor.firebaseapp.com",
  databaseURL: "https://pakisa-floor-default-rtdb.firebaseio.com",
  projectId: "pakisa-floor"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const scanBody = document.getElementById("scanBody");
const searchInput = document.getElementById("searchInput");

let scans = [];

/* ðŸ”¥ RAW REALTIME LISTENER */
onValue(ref(db, "scans"), snapshot => {
  console.log("ðŸ”¥ RAW FIREBASE DATA:", snapshot.val());

  scans = [];
  scanBody.innerHTML = "";

  if (!snapshot.exists()) {
    scanBody.innerHTML = "<tr><td colspan='4'>No scans found</td></tr>";
    return;
  }

  snapshot.forEach(child => {
    scans.push(child.val());
  });

  render(scans);
});

/* RENDER TABLE */
function render(data) {
  scanBody.innerHTML = "";

  data
    .sort((a,b) => b.timestamp - a.timestamp)
    .forEach(s => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${s.waybill}</td>
        <td>${s.customer}</td>
        <td>${s.reason}</td>
        <td>${s.date}</td>
      `;
      scanBody.appendChild(row);
    });
}

/* SEARCH */
searchInput.addEventListener("input", () => {
  const q = searchInput.value.toLowerCase();
  render(
    scans.filter(s =>
      s.waybill.includes(q) ||
      s.customer.toLowerCase().includes(q) ||
      s.reason.toLowerCase().includes(q)
    )
  );
});
</script>

</body>
</html>
