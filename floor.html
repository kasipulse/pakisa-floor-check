<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pakisa Floor Scan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; background:#f4f4f4; padding:20px; }
    input, select { padding:8px; margin:5px 0; width:100%; }
    table { width:100%; border-collapse: collapse; margin-top:20px; }
    th, td { border:1px solid #ccc; padding:8px; text-align:left; }
    th { background:#333; color:#fff; }
  </style>
</head>
<body>

<h2>Pakisa Floor â€“ Scan List</h2>

<input id="search" placeholder="Search waybill / customer / reason" />

<table>
  <thead>
    <tr>
      <th>Waybill</th>
      <th>Customer</th>
      <th>Reason</th>
      <th>Date</th>
    </tr>
  </thead>
  <tbody id="scanTable"></tbody>
</table>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBh-KhkmZrS6b97MPv-YTMjU6qTF0qFzbY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
    projectId: "YOUR_PROJECT",
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const scansRef = ref(db, "scans");

  const table = document.getElementById("scanTable");
  const searchInput = document.getElementById("search");

  let scans = [];

  onValue(scansRef, snapshot => {
    console.log("RAW SNAPSHOT:", snapshot.val());

    scans = [];

    snapshot.forEach(child => {
      scans.push(child.val());
    });

    render(scans);
  });

  function render(data) {
    table.innerHTML = "";

    if (!data.length) {
      table.innerHTML = "<tr><td colspan='4'>No scans found</td></tr>";
      return;
    }

    data
      .sort((a,b) => b.timestamp - a.timestamp)
      .forEach(s => {
        table.innerHTML += `
          <tr>
            <td>${s.waybill}</td>
            <td>${s.customer}</td>
            <td>${s.reason}</td>
            <td>${s.date}</td>
          </tr>
        `;
      });
  }

  searchInput.addEventListener("input", e => {
    const q = e.target.value.toLowerCase();

    const filtered = scans.filter(s =>
      s.waybill.includes(q) ||
      s.customer.toLowerCase().includes(q) ||
      s.reason.toLowerCase().includes(q)
    );

    render(filtered);
  });
</script>

</body>
</html>
